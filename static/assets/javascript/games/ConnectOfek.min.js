function start_ponder(){pondering=setInterval(function(){global_ROOT||(global_ROOT=create_MCTS_root());for(var e=(new Date).getTime(),t=0;(new Date).getTime()-e<30&&!stop_choose;)global_ROOT.choose_child(),t++;num_choose3&&(num_choose3/10>t||num_choose2/10>t||num_choose1/10>t)?stop_choose=!0:(num_choose3=num_choose2,num_choose2=num_choose1,num_choose1=t),update_analysis()},1)}function stop_ponder(){clearInterval(pondering)}function adjust_buttons(){$(".footer button").css("font-size",disc_height/4),$(".footer").css("height",disc_height/2),$(".footer").css("margin-bottom",disc_height/4-$("#back").outerHeight(!1)),$(".footer #anal").css("line-height",disc_height/2+"px"),$(".footer #num-trials").css("line-height",disc_height/2+"px")}function update_analysis(){var e=get_MCTS_depth_range();$("#anal").text("Analysis: Depth-"+e[1]+" Result-"+e[2]+" Certainty-"+(global_ROOT&&global_ROOT.total_tries>0?(100*result_certainty(global_ROOT)).toFixed(0):"0")+"%"),$("#num-trials").text("Trials: "+global_ROOT.total_tries)}function result_certainty(e){return e.total_tries>2*(e.hits+e.misses)?1-(e.hits+e.misses)/e.total_tries:e.hits>e.misses?(e.hits-e.misses)/e.total_tries:e.hits<e.misses?(e.misses-e.hits)/e.total_tries:1-(e.hits+e.misses)/e.total_tries}function new_game(e){cookie_id=e.replace(/#/g,""),0===cookie_id.length&&(cookie_id=new_cookie_id()),window.location.hash=cookie_id;var t=getCookie(cookie_id);if(t&&t.length>0)return void new_game_cookie(t);disc_width=docwidth/(dimensions[0]+1),disc_height=docheight/(dimensions[1]+1),adjust_buttons(),over=-1,board=new Array(dimensions[0]);for(var o=0;o<board.length;o++){board[o]=new Array(dimensions[1]);for(var n=0;n<board[o].length;n++)board[o][n]=0}red_turn_global=!0,num_choose1=num_choose2=num_choose3=lnc1=lnc2=lnc3=stop_choose=!1,position="",save_settings_cookie(cookie_id),global_ROOT=create_MCTS_root(),draw_board(),(ai_turn==red_turn_global||"both"==ai_turn)&&setTimeout(play_ai_move,20),stop_ponder(),ponder&&start_ponder()}function new_game_cookie(e){load_settings_cookie(e),disc_width=docwidth/(dimensions[0]+1),disc_height=docheight/(dimensions[1]+1),adjust_buttons(),board=new Array(dimensions[0]);for(var t=0;t<board.length;t++){board[t]=new Array(dimensions[1]);for(var o=0;o<board[t].length;o++)board[t][o]=0}red_turn_global=!0,num_choose1=num_choose2=num_choose3=lnc1=lnc2=lnc3=stop_choose=!1,setup_position(position),global_ROOT=create_MCTS_root(),draw_board(),(ai_turn==red_turn_global||"both"==ai_turn)&&setTimeout(play_ai_move,20),stop_ponder(),ponder&&start_ponder()}function new_cookie_id(){var e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";do{e="";for(var o=0;5>o;o++)e+=t.charAt(Math.floor(Math.random()*t.length))}while(getCookie(e));return e}function save_settings_cookie(e){var t={};t.over=over,t.ponder=ponder,t.ai_turn=ai_turn,t.position=position,t.dimensions=dimensions,t.expansion_const=expansion_const,t.smart_simulation=smart_simulation,t.increasing_factor=increasing_factor,t.monte_carlo_trials=monte_carlo_trials,t.certainty_threshold=certainty_threshold,setCookie(e,JSON.stringify(t),10)}function load_settings_cookie(e){var t=JSON.parse(e);over=t.over,ponder=t.ponder,ai_turn=t.ai_turn,position=t.position,dimensions=t.dimensions,expansion_const=t.expansion_const,smart_simulation=t.smart_simulation,increasing_factor=t.increasing_factor,monte_carlo_trials=t.monte_carlo_trials,certainty_threshold=t.certainty_threshold}function setup_position(e){if(!e||0===e.length)return position="",!0;for(var t=0;t<e.length;t++){var o=parseInt(e.charAt(t),10)-1;if(!legal_move(board,o,!1))return!1;play_move(board,o,red_turn_global),red_turn_global=!red_turn_global}return!0}function setup_board(e){var t,o,n,r=new Array(dimensions[0]);for(t=0;t<dimensions[0];t++)for(r[t]=new Array(dimensions[1]),o=0;o<dimensions[1];o++)r[t][o]=0;for(t=0;t<e.length;t++)for(n=parseInt(e.charAt(t),10)-1,o=dimensions[1]-1;o>=0;o--)if(0===r[n][o]){r[n][o]=t%2===0?1:2;break}return r}function drawEllipse(e,t,o,n){var r=.5522848,i=o/2*r,a=n/2*r,s=e+o,l=t+n,_=e+o/2,c=t+n/2;brush.moveTo(e,c),brush.bezierCurveTo(e,c-a,_-i,t,_,t),brush.bezierCurveTo(_+i,t,s,c-a,s,c),brush.bezierCurveTo(s,c+a,_+i,l,_,l),brush.bezierCurveTo(_-i,l,e,c+a,e,c)}function clear_board(){brush.clearRect(0,0,docwidth,docheight)}function draw_grid(){brush.lineWidth=2,brush.strokeStyle="black",brush.beginPath();for(var e=disc_width/2;docwidth>e;e+=disc_width)brush.moveTo(e,disc_height/2),brush.lineTo(e,docheight-disc_height/2);for(var t=3*disc_height/2;docheight>t;t+=disc_height)brush.moveTo(disc_width/2,t),brush.lineTo(docwidth-disc_width/2,t);brush.stroke(),brush.closePath()}function draw_piece(e,t){switch(board[e][t]){case 1:brush.fillStyle="red";break;case 2:brush.fillStyle="yellow";break;default:return}brush.beginPath(),drawEllipse(e*disc_width+disc_width/2,t*disc_height+disc_height/2,disc_width,disc_height),brush.fill(),brush.closePath()}function draw_board(){clear_board(),update_analysis();for(var e=0;e<board.length;e++)for(var t=0;t<board[e].length;t++)0!==board[e][t]&&draw_piece(e,t);draw_grid()}function draw_hover(e){var t=red_turn_global?1:2;switch(draw_board(),t){case 1:brush.fillStyle="red";break;case 2:brush.fillStyle="yellow";break;default:return}brush.beginPath(),drawEllipse(e*disc_width+disc_width/2,0,disc_width,disc_height),brush.fill(),brush.closePath()}function get_col(e,t){return e>docwidth-disc_width/2||disc_width/2>e?-1:t>docheight-disc_height/2?-2:Math.floor((e-disc_width/2)/disc_width)}function legal_move(e,t,o){return-2==t?!1:0>t?(o&&alert("Please press on the board!"),!1):0!==e[t][0]?(o&&alert("Column already full!"),!1):!0}function set_turn(e,t,o){position+=t+1,red_turn_global=e,global_ROOT=MCTS_get_next_root(t),global_ROOT?global_ROOT.parent=null:global_ROOT=create_MCTS_root();var n=most_tried_child(global_ROOT,null);if(-1==over&&(e===ai_turn||"both"==ai_turn)&&n&&n.last_move?draw_hover(n.last_move):draw_board(),over=game_over(board,t,o),save_settings_cookie(cookie_id),-1!=over){switch(over){case 0:alert("Game tied!");break;case 1:alert("Red wins!");break;case 2:alert("Yellow wins!")}stop_ponder()}monte_carlo_trials*=increasing_factor,num_choose1=num_choose2=num_choose3=stop_choose=!1,-1!=over||e!==ai_turn&&"both"!=ai_turn||setTimeout(play_ai_move,25)}function play_move(e,t,o){if(0!==e[t][0])return-1;var n,r=o?1:2;for(n=e[t].length-1;0!==e[t][n];n--);return e[t][n]=r,n}function get_winning_move(e,t){for(var o,n=t?1:2,r=0;r<e.length;r++)if(0===e[r][0]){for(o=e[r].length-1;0!==e[r][o];o--);if(-1!=game_over_color(e,r,o,n))return[r,o]}return!1}function MCTS_get_children(e,t){var o=setup_board(e.board);if(e.game_over)return[];var n=get_winning_move(o,e.turn);if(n){var r=new State(e.board+(n[0]+1),!e.turn);return r.game_over=!0,[new MCTS_Node(r,t,n[0])]}if(n=get_winning_move(o,!e.turn))return[new MCTS_Node(new State(e.board+(n[0]+1),!e.turn),t,n[0])];var i,a=0;for(i=0;i<o.length;i++)0===o[i][0]&&a++;var s=new Array(a);for(i=0;i<o.length;i++)0===o[i][0]&&(s[--a]=new MCTS_Node(new State(e.board+(i+1),!e.turn),t,i));for(var l=0;l<s.length-1;l++)for(var _=l+1;_<s.length;_++)identical_boards(setup_board(s[l].State.board),setup_board(s[_].State.board))&&(s.splice(_,1),_--);return s}function ib(e,t){for(var o=0;o<e.length;o++)if(+e.charAt(o)!=+t.charAt(o)&&+e.charAt(o)!=dimensions[0]-+t.charAt(o))return!1;return!0}function MCTS_dumb_simulate(e){if(e.game_over)return-1;for(var t,o,n=setup_board(e.board),r=e.turn,i=!1;-1==i;){do o=Math.random()*n.length|0,t=play_move(n,o,r);while(0>t);i=game_over(n,o,t),r=!r}return 0===i?0:i==(e.turn?1:2)?1:-1}function MCTS_simulate_smart(e){for(var t,o,n,r=setup_board(e.board),i=e.turn,a=game_over_full(r);-1==a;){if(t=get_winning_move(r,i),t||(t=get_winning_move(r,!i)),t)r[t[0]][t[1]]=i?1:2,n=t[0],o=t[1];else do n=Math.random()*r.length|0,o=play_move(r,n,i);while(0>o);a=game_over(r,n,o),i=!i}return 0===a?0:a==(e.turn?1:2)?1:-1}function create_MCTS_root(){return MCTS_simulate=smart_simulation?MCTS_simulate_smart:MCTS_dumb_simulate,new MCTS_Node(new State(position,red_turn_global),null,null)}function MCTS_get_next_root(e){if(!global_ROOT||!global_ROOT.children)return null;for(var t=0;t<global_ROOT.children.length;t++)if(global_ROOT.children[t].last_move==e)return global_ROOT.children[t];return null}function run_MCTS(e,t,o){global_ROOT||(global_ROOT=create_MCTS_root()),run_MCTS_recursive(e,t,o,0)}function run_MCTS_recursive(e,t,o,n){for(var r=(new Date).getTime(),i=e;e>0&&(new Date).getTime()-r<100;)global_ROOT.choose_child(),e--;if(n%20===0&&(draw_hover(most_tried_child(global_ROOT,null).last_move),t>0)){var a=get_certainty(global_ROOT);if(console.log(a),global_ROOT.children.length<2||t>a)return void o()}ai_stopped||0>=e||stop_choose?o():lnc3&&(lnc3/5>i-e||lnc2/5>i-e||lnc1/5>i-e)?(console.log(i-e,lnc3),o()):(lnc3=lnc2,lnc2=lnc1,lnc1=i-e,setTimeout(function(){run_MCTS_recursive(e,t,o,++n)},1))}function get_certainty(e){var t=most_tried_child(e,null),o=most_tried_child(e,t).total_tries/t.total_tries,n=t.hits<t.misses?t.hits/t.misses*2:t.misses/t.hits*3;return o>n?n:o}function most_tried_child(e,t){var o=0,n=null;if(!e.children)return null;if(1==e.children.length)return e.children[0];for(var r=0;r<e.children.length;r++)e.children[r]!=t&&e.children[r].total_tries>o&&(o=e.children[r].total_tries,n=e.children[r]);return n}function least_tried_child(e){var t=e.total_tries+1,o=null;if(!e.children)return null;for(var n=0;n<e.children.length;n++)e.children[n].total_tries<t&&(t=e.children[n].total_tries,o=e.children[n]);return o}function get_MCTS_depth_range(){var e,t=new Array(3);for(t[0]=-1,e=global_ROOT;e&&e.children;t[0]++,e=least_tried_child(e));for(t[1]=-1,e=global_ROOT;e&&e.children;t[1]++,e=most_tried_child(e));return global_ROOT.total_tries>3*(global_ROOT.hits+global_ROOT.misses)?t[2]="Tie":global_ROOT.hits>global_ROOT.misses==red_turn_global?t[2]="R":global_ROOT.hits<global_ROOT.misses==red_turn_global?t[2]="Y":t[2]="Tie",t}function get_best_move_MCTS(){var e=most_tried_child(global_ROOT,null);return e?e.last_move:-1}function play_ai_move(){ai_stopped=!1,!global_ROOT||global_ROOT.total_tries<monte_carlo_trials&&1>certainty_threshold&&(!global_ROOT.children||1!=global_ROOT.children.length)?run_MCTS(monte_carlo_trials-global_ROOT.total_tries,certainty_threshold,fpaim):fpaim()}function fpaim(){var e=get_best_move_MCTS(),t=play_move(board,e,red_turn_global);set_turn(!red_turn_global,e,t)}function onetotwod(e){for(var t=new Array(dimensions[0]),o=0;o<dimensions[0];o++)t[o]=e.slice(o*dimensions[1],(o+1)*dimensions[1]);return t}function twotooned(e){for(var t=new Array(dimensions[0]*dimensions[1]),o=0;o<dimensions[0]*dimensions[1];o++)t[o]=e[o/dimensions[1]|0][o%dimensions[1]];return t}function game_over(e,t,o){var n,r,i=1,a=e[t][o];for(n=t-1;n>=0&&4>i&&e[n][o]==a;n--,i++);for(n=t+1;n<e.length&&4>i&&e[n][o]==a;n++,i++);if(4==i)return a;for(i=1,r=o-1;r>=0&&4>i&&e[t][r]==a;r--,i++);for(r=o+1;r<e[0].length&&4>i&&e[t][r]==a;r++,i++);if(4==i)return a;for(i=1,n=t-1,r=o-1;n>=0&&r>=0&&4>i&&e[n][r]==a;r--,n--,i++);for(n=t+1,r=o+1;n<e.length&&r<e[0].length&&4>i&&e[n][r]==a;r++,n++,i++);if(4==i)return a;for(i=1,n=t-1,r=o+1;n>=0&&r<e[0].length&&4>i&&e[n][r]==a;r++,n--,i++);for(n=t+1,r=o-1;n<e.length&&r>=0&&4>i&&e[n][r]==a;r--,n++,i++);if(4==i)return a;for(n=0;n<e.length;n++)if(0===e[n][0])return-1;return 0}function game_over_color(e,t,o,n){var r,i,a=1;for(r=t-1;r>=0&&4>a&&e[r][o]==n;r--,a++);for(r=t+1;r<e.length&&4>a&&e[r][o]==n;r++,a++);if(4==a)return n;for(a=1,i=o-1;i>=0&&4>a&&e[t][i]==n;i--,a++);for(i=o+1;i<e[0].length&&4>a&&e[t][i]==n;i++,a++);if(4==a)return n;for(a=1,r=t-1,i=o-1;r>=0&&i>=0&&4>a&&e[r][i]==n;i--,r--,a++);for(r=t+1,i=o+1;r<e.length&&i<e[0].length&&4>a&&e[r][i]==n;i++,r++,a++);if(4==a)return n;for(a=1,r=t-1,i=o+1;r>=0&&i<e[0].length&&4>a&&e[r][i]==n;i++,r--,a++);for(r=t+1,i=o-1;r<e.length&&i>=0&&4>a&&e[r][i]==n;i--,r++,a++);if(4==a)return n;for(r=0;r<e.length;r++)if(0===e[r][0])return-1;return 0}function game_over_full(e){var t,o,n=0,r=3;for(t=0;t<e.length;t++){for(o=0;o<e[t].length;o++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;for(n=0,r=3,o=0;o<e[0].length;o++){for(t=0;t<e.length;t++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;n=0,r=3;var i,a;for(i=0;i<e.length;i++){for(t=i,o=0;t<e.length&&o<e[t].length;t++,o++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;for(n=0,r=3,a=1;a<e[0].length;a++){for(t=0,o=a;t<e.length&&o<e[t].length;t++,o++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;for(n=0,r=3,i=0;i<e.length;i++){for(t=i,o=0;t>=0&&o<e[t].length;t--,o++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;for(n=0,r=3,a=1;a<e[0].length;a++){for(t=e.length-1,o=a;t>=0&&o<e[t].length;t--,o++)if(4>n)0===e[t][o]?r=3:e[t][o]==r?n++:(r=e[t][o],n=1);else if(4==n)return r;if(4==n)return r;n=0}if(4==n)return r;for(t=0;t<e.length;t++)if(0===e[t][0])return-1;return 0}function identical_boards(e,t){for(var o=0;o<e.length/2;o++)for(var n=0;n<e[o].length;n++)if(e[o][n]!=t[e.length-1-o][n])return!1;return!0}function show_new_game_menu(){$("#new-game-menu").animate({opacity:.9},"slow").css("z-index",100)}function setCookie(e,t,o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var r="expires="+n.toUTCString();document.cookie=e+"="+t+"; "+r}function getCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return""}function MCTS_child_potential(e,t){var o=e.misses-e.hits,n=e.total_tries,r=expansion_const;return o/n+r*Math.sqrt(Math.log(t)/n)}function efficiency_test(){global_ROOT=create_MCTS_root();var e,t=(new Date).getTime();for(e=0;1e5>e;e++)global_ROOT.choose_child();console.log(((new Date).getTime()-t)/1e3),setInterval(function(){for(var e=0;1e3>e;e++)global_ROOT.choose_child();$("#num-trials").text(global_ROOT.total_tries)},1)}function speed_test(){global_ROOT=create_MCTS_root();var e,t=(new Date).getTime();for(e=0;5e5>e;e++)global_ROOT.choose_child();console.log(((new Date).getTime()-t)/1e3)}var docwidth,docheight,disc_width,disc_height,dimensions=[7,6],board,red_turn_global,global_ROOT,expansion_const=2.5,ai_turn=!1,monte_carlo_trials=1e4,over,ponder=!0,pondering,certainty_threshold=.15,position,cookie_id,ai_stopped=!1,smart_simulation=!0,increasing_factor=1.07,boardui=document.getElementById("board"),brush=boardui.getContext("2d"),num_choose1,num_choose2,num_choose3,lnc1,lnc2,lnc3,stop_choose;$(document).ready(function(){docwidth=$("#content-wrapper").outerWidth(!0),docheight=$("#content-wrapper").outerHeight(!0),$("#board").width(docwidth).height(docheight),boardui.setAttribute("width",docwidth),boardui.setAttribute("height",docheight),$("#form-new-game").height(.6*docheight),$("#new-game-btn").css("top",(docheight-$("#new-game-btn").height())/2),$("#new-game-btn").css("left",(docwidth-$("#new-game-btn").outerWidth())/2),$("#new-game-menu").css("top",(docheight-$("#new-game-menu").outerHeight())/2),$("#new-game-menu").css("left",(docwidth-$("#new-game-menu").outerWidth())/2),new_game(window.location.hash),$('input[name="name"]').val(new_cookie_id())}),$(window).resize(function(){$("#content-wrapper").outerWidth($(window).outerWidth(!0)),$("#content-wrapper").outerHeight($(window).outerHeight(!0)-$("#content-wrapper").position().top),docwidth=$("#content-wrapper").outerWidth(!0),docheight=$("#content-wrapper").outerHeight(!0),$("#board").width(docwidth).height(docheight),boardui.setAttribute("width",docwidth),boardui.setAttribute("height",docheight),disc_width=docwidth/(dimensions[0]+1),disc_height=docheight/(dimensions[1]+1),$("#form-new-game").height(.6*docheight),$("#new-game-btn").css("top",(docheight-$("#new-game-btn").height())/2),$("#new-game-btn").css("left",(docwidth-$("#new-game-btn").outerWidth())/2),$("#new-game-menu").css("top",(docheight-$("#new-game-menu").outerHeight())/2),$("#new-game-menu").css("left",(docwidth-$("#new-game-menu").outerWidth())/2),draw_board()}),$("#board").mousedown(function(e){if(3!==e.which&&red_turn_global!=ai_turn&&"both"!=ai_turn){if(-1!=over)return void alert("The game is already over!");var t=get_col(e.pageX,e.pageY);if(legal_move(board,t,!0)){var o=play_move(board,t,red_turn_global);set_turn(!red_turn_global,t,o)}}}),$("#board").mousemove(function(e){if(red_turn_global!=ai_turn&&"both"!=ai_turn&&-1==over){var t=get_col(e.pageX);legal_move(board,t,!1)&&draw_hover(t)}});var MCTS_simulate;$("#new-game").click(show_new_game_menu);var dont_submit;$("#form-new-game").submit(function(){if(dont_submit)return dont_submit=!1,!1;switch(dimensions[0]=parseInt($('input[name="d_width"]').val()),dimensions[1]=parseInt($('input[name="d_height"]').val()),$('select[name="ai-turn"]').val()){case"first":ai_turn=!0;break;case"second":ai_turn=!1;break;case"both":ai_turn="both";break;default:ai_turn=null}var e=$('input[name="allow-ponder"]').prop("checked");switch($('select[name="ai-diff"]').val().toLowerCase()){case"custom":smart_simulation=$('input[name="smart-simulation"]').prop("checked"),monte_carlo_trials=$('input[name="mc-trials"]').val(),expansion_const=$('input[name="mc-expansion"]').val(),certainty_threshold=(1-$('input[name="mc-certainty"]').val()/100).toFixed(2),ponder=$('input[name="ai-ponder"]').prop("checked"),increasing_factor=1.05;break;case"stupid":smart_simulation=!1,monte_carlo_trials=2*dimensions[0],expansion_const=10,certainty_threshold=0,ponder=!1,increasing_factor=1;break;case"ehh":smart_simulation=!0,monte_carlo_trials=dimensions[0]*dimensions[1],expansion_const=2,certainty_threshold=0,ponder=!1,increasing_factor=1;break;case"play fast":smart_simulation=!1,monte_carlo_trials=0,expansion_const=2,certainty_threshold=1,ponder=!0,increasing_factor=1.05;break;case"normal":smart_simulation=!0,monte_carlo_trials=1e3,expansion_const=10,certainty_threshold=.4,ponder=!1,increasing_factor=1.1;break;case"play fast ++":smart_simulation=!0,monte_carlo_trials=0,expansion_const=2.5,certainty_threshold=1,ponder=!0,increasing_factor=1.08;break;case"win fast":smart_simulation=!0,monte_carlo_trials=500,expansion_const=2,certainty_threshold=.25,ponder=!1,increasing_factor=1.23;break;case"hard":smart_simulation=!0,monte_carlo_trials=5e3,expansion_const=2,certainty_threshold=.25,ponder=!0,increasing_factor=1.07;break;case"very hard":smart_simulation=!0,monte_carlo_trials=1e4,expansion_const=2,certainty_threshold=.15,ponder=!0,increasing_factor=1.07;break;case"good luck":smart_simulation=!0,monte_carlo_trials=15e4,expansion_const=5,certainty_threshold=.05,ponder=!0,increasing_factor=1.07;break;case"wreckage":smart_simulation=!0,monte_carlo_trials=5e6,expansion_const=6,certainty_threshold=.01,ponder=!0,increasing_factor=1.07}e||(ponder=!1),position=$('input[name="position"]').val(),monte_carlo_trials*=Math.pow(increasing_factor,position.length);var t=$('input[name="name"]').val();return over=-1,save_settings_cookie(t),$("#new-game-menu").animate({opacity:0},"slow",function(){$(this).css("z-index",-1),$('input[name="name"]').val(new_cookie_id()),new_game(t)}),!1}),$("#btn-new-game-cancel").click(function(){dont_submit=!0,$("#new-game-menu").animate({opacity:0},"slow",function(){$(this).css("z-index",-1)})}),$("#back").click(function(){ai_turn===!0||ai_turn===!1?(position=position.substring(0,position.length-2),monte_carlo_trials/=Math.pow(increasing_factor,2)):(position=position.substring(0,position.length-1),monte_carlo_trials/=increasing_factor),over=-1,save_settings_cookie(cookie_id),new_game(cookie_id)}),$("#stop-ai").click(function(){ai_stopped=!0,ai_turn="None"}),$("#start-ai").click(function(){ai_turn!=red_turn_global&&"Both"!=ai_turn&&(ai_turn=red_turn_global,play_ai_move())});var State=function(e,t){this.board=e,this.turn=t},MCTS_Node=function(e,t,o){this.State=e,this.parent=t,this.last_move=o,this.hits=0,this.misses=0,this.total_tries=0};MCTS_Node.prototype.choose_child=function(){if(this.children||(this.children=MCTS_get_children(this.State,this)),0===this.children.length)this.run_simulation();else{var e,t=0;for(e=0;e<this.children.length;e++)0===this.children[e].total_tries&&t++;if(t>0){Math.floor(Math.random()*t);for(e=0;e<this.children.length;e++)if(0===this.children[e].total_tries&&(t--,0===t))return void this.children[e].run_simulation()}else{var o,n=this.children[0],r=MCTS_child_potential(this.children[0],this.total_tries);for(e=1;e<this.children.length;e++)o=MCTS_child_potential(this.children[e],this.total_tries),o>r&&(r=o,n=this.children[e]);n.choose_child()}}},MCTS_Node.prototype.run_simulation=function(){this.back_propogate(MCTS_simulate(this.State))},MCTS_Node.prototype.back_propogate=function(e){e>0?this.hits++:0>e&&this.misses++,this.total_tries++,this.parent&&(this.parent.State.turn===this.State.turn?this.parent.back_propogate(e):this.parent.back_propogate(-e))};